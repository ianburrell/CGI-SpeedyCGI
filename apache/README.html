<HTML>
<HEAD>
<TITLE>mod_speedycgi - SpeedyCGI Apache module</TITLE>
<LINK REV="made" HREF="mailto:sam@angel.daemoninc.com">
</HEAD>

<BODY>

<!-- INDEX BEGIN -->

<UL>

	<LI><A HREF="#NAME">NAME</A>
	<LI><A HREF="#DESCRIPTION">DESCRIPTION</A>
	<LI><A HREF="#INSTALLATION">INSTALLATION</A>
	<LI><A HREF="#CONFIGURATION">CONFIGURATION</A>
	<UL>

		<LI><A HREF="#Path_Configuration">Path Configuration</A>
		<LI><A HREF="#File_Extension_Configuration">File Extension Configuration</A>
		<LI><A HREF="#Options">Options</A>
		<LI><A HREF="#Warning">Warning</A>
	</UL>

</UL>
<!-- INDEX END -->

<HR>
<P>
<H1><A NAME="NAME">NAME</A></H1>
<P>
mod_speedycgi - SpeedyCGI Apache module

<P>
<HR>
<H1><A NAME="DESCRIPTION">DESCRIPTION</A></H1>
<P>
mod_speedycgi is a module for the Apache web server that interfaces to
SpeedyCGI. mod_speedycgi is <STRONG>not</STRONG> required in order to run SpeedyCGI under Apache -- it's only a performance
improvement. mod_speedycgi saves the web-server from having to fork/exec
the speedy binary for each request.

<P>
mod_speedycgi only replaces the front-end portion of SpeedyCGI. The
back-end (where perl runs) remains the same. No perl code runs within the
web server itself - each perl cgi-bin continues to run in its own separate
process.

<P>
<HR>
<H1><A NAME="INSTALLATION">INSTALLATION</A></H1>
<P>
You will need to have:

<UL>
<LI>
<P>
The SpeedyCGI sources, already compiled and installed (do not run
"make&nbsp;clean").

<LI>
<P>
The Apache 1.3.6 sources

</UL>
<P>
A script is provided (``make_apache.pl'') to do the apache build for you.
Type ``perl make_apache.pl'' to use it.

<P>
If you want to install manually, do the following:

<OL>
<LI>
<P>
Locate the path for:

<P>
<PRE>    SpeedyCGI sources              (referred to as &quot;/speedy_src&quot;)
    Apache sources                 (referred to as &quot;/apache_src&quot;)
    Apache installation directory  (referred to as &quot;/apache_inst&quot;)
</PRE>
<LI>
<P>
Make the speedycgi modules directory:

<P>
<PRE>    mkdir /apache_src/src/modules/speedycgi
</PRE>
<LI>
<P>
Create a Makefile.tmpl file in /apache_src/src/modules/speedycgi directory
that contains these lines:

<P>
<PRE>    EXTRA_INCLUDES=-I/speedy_src/libspeedy
</PRE>
<P>
<PRE>    #Dependencies
</PRE>
<P>
<PRE>    $(OBJS) $(OBJS_PIC): Makefile
</PRE>
<P>
<PRE>    # DO NOT REMOVE
</PRE>
<LI>
<P>
Extract the libspeedy.a object files into the apache sources: Make a note
of the object files that were extracted -- you will need this list in
step-7 below.

<P>
<PRE>    cd /apache_src/src/modules/speedycgi
    ar xv /speedy_src/libspeedy/blib/arch/auto/libspeedy/libspeedy.a
</PRE>
<LI>
<P>
Copy over the mod_speedycgi.c source code:

<P>
<PRE>    cp /speedy_src/apache/mod_speedycgi.c .
</PRE>
<LI>
<P>
Configure Apache:

<P>
<PRE>    cd /apache_src
    ./configure --prefix=/apache_inst \
        --activate-module=src/modules/speedycgi/libspeedycgi.a \
        --disable-shared=speedycgi
</PRE>
<LI>
<P>
Fix the speedycgi Makefile.

<P>
<PRE>    Edit /apache_src/src/modules/speedycgi/Makefile and change the &quot;OBJS=&quot;
    line so it contains &quot;mod_speedycgi.o&quot;, plus all the .o files that
    were extracted in step 4 above.
</PRE>
<LI>
<P>
Run ``make'' to build apache.

<P>
<PRE>    cd /apache_src
    make
</PRE>
<LI>
<P>
If all looks good, install Apache with:

<P>
<PRE>    make install
</PRE>
</OL>
<P>
<HR>
<H1><A NAME="CONFIGURATION">CONFIGURATION</A></H1>
<P>
You can configure mod_speedycgi to either use a certain path on the web
server (similar to the way /cgi-bin works) or use files with a certain
extension (similar to the way .cgi files work).

<P>
<HR>
<H2><A NAME="Path_Configuration">Path Configuration</A></H2>
<P>
In this example, the /speedy path will be setup so that scripts run under
that path will use SpeedyCGI.

<P>
Add these lines near the <STRONG>top</STRONG> of your httpd.conf (``/apache_inst'' is the Apache installation directory):

<P>
<PRE>    Alias /speedy/ &quot;/apache_inst/cgi-bin/&quot;
    &lt;Location /speedy&gt;
        SetHandler speedycgi-script
        Options ExecCGI
        allow from all
    &lt;/Location&gt;
</PRE>
<P>
If you still have the ``printenv'' cgi-bin script that was shipped with
Apache, you should be able to test with

<P>
<PRE>    <A HREF="http://yourwebsite/speedy/printenv">http://yourwebsite/speedy/printenv</A>
</PRE>
<P>
You may have to ``chmod a+x printenv'' to make it executable.

<P>
<HR>
<H2><A NAME="File_Extension_Configuration">File Extension Configuration</A></H2>
<P>
In the example below, all scripts ending with ``.speedy'' will be set up to
run under SpeedyCGI:

<P>
Add these lines near the <STRONG>top</STRONG> of your httpd.conf:

<P>
<PRE>    AddHandler speedycgi-script .speedy
    &lt;Location /&gt;
        Options ExecCGI
    &lt;/Location&gt;
</PRE>
<P>
You can test by creating a small ``test.speedy'' script in your htdocs
directory. That file should contain:

<P>
<PRE>    print &quot;Content-type: text/html\n\nMy pid is $$\n&quot;;
</PRE>
<P>
Make sure to ``chmod a+x test.speedy'', then test with the URL

<P>
<PRE>    <A HREF="http://yourwebsite/test.speedy">http://yourwebsite/test.speedy</A>
</PRE>
<P>
<HR>
<H2><A NAME="Options">Options</A></H2>
<P>
SpeedyCGI options can also be added to httpd.conf file. Type "perldoc&nbsp;CGI::SpeedyCGI" for details.

<P>
<HR>
<H2><A NAME="Warning">Warning</A></H2>
<P>
Following the above instructions may compromise the security of your web
site. The security risks associated with SpeedyCGI are similar to those of
regular CGI. If you don't understand the security implications of the
changes above then don't make them.
</BODY>

</HTML>
