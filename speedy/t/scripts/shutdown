
use CGI::SpeedyCGI;

my $sp = CGI::SpeedyCGI->new;

my $method = ($ARGV[1] == 1) ? 'add_shutdown_handler' : 'set_shutdown_handler';
$sp->$method(sub {open(F, ">$ARGV[0]")});

BEGIN {
    $SIG{TERM} = IGNORE;
}

if ($ARGV[1] == 2) {
    $sp->shutdown_next_time();
}
elsif ($ARGV[1] == 3) {
    $sp->shutdown_now();
}

print $$;
